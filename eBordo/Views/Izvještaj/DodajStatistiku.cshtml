@using eBordo.ViewModels.Izvještaj
@model StatistikaDodajVM

@{
    var izmjena = (bool)ViewData["izmjena"];
}

<style>
    #btnCollapseUp, #btnCollapseDown {
        float: right;
    }

</style>
<div class="row">
    <div class="col">
        <h5 style="color:maroon">Evidentiraj ocjenu</h5>
    </div>
    <div class="col" id="DownUp" style="margin-bottom:25px;">
        <button id="btnCollapseDown" type="button" class="btn btn-outline-warning btn-sm"><span style="float:right;" id="spanAcc" class="material-icons">keyboard_arrow_down</span></button>
        <button id="btnCollapseUp" type="button" class="btn btn-outline-danger btn-sm"><span style="float:right;" id="spanAcc" class="material-icons">keyboard_arrow_up</span></button>
    </div>
</div>
<div class="collapse" id="clps1">
    <form id="snimiStatistiku">
        <div class="row">
            <div class="col">
                <input id="utakmicaID" hidden asp-for="utakmicaID" />
                <div class="row" id="statistika">
                    <div class="col-3">
                        <span>Igrač</span>
                    </div>
                    <div class="col" id="colPadding">
                        <img src="https://tmsi.akamaized.net/icons/Spiele.svg" id="statistikaLogo" />
                    </div>
                    <div class="col" id="colPadding">
                        <img src="https://tmsi.akamaized.net/icons/ball_blau.svg" id="statistikaLogo" />
                    </div>
                    <div class="col" id="colPadding">
                        <img src="https://tmsi.akamaized.net/icons/ball_gruen.svg" id="statistikaLogo" />
                    </div>
                    <div class="col" id="colPadding">
                        <img src="https://tmsi.akamaized.net/icons/gelbe_karte.svg" id="statistikaLogo" />
                    </div>
                    <div class="col" id="colPadding">
                        <img src="https://tmsi.akamaized.net/icons/rote_karte.svg" id="statistikaLogo" />
                    </div>
                    <div class="col" style="padding-left:5px;">
                        <img src="https://i.postimg.cc/xTc7HKQM/bar-chart-676.png" id="statistikaLogo" />
                    </div>
                </div>
                <div class="row" id="statistika">
                    <div class="col-3">
                        @if (Model.igracID != 0)
                        {
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                                </div>
                                <select disabled id="selectIgraci" class="form-control" asp-for="igracID" asp-items="Model.igraci"></select>
                            </div>
                            <input hidden asp-for="igracID" />
                        }
                        else
                        {
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                        </div>
                        <select id="selectIgraci" class="form-control" asp-for="igracID" asp-items="Model.igraci"></select>
                    </div>
                        }
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend" style="width:25px;">
                                <span class="input-group-text" style="padding-left:4px;padding-right:6px;" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input name="minute" id="minute" class="form-control" asp-for="minute" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend" style="width:25px;">
                                <span class="input-group-text" style="padding-left:4px;padding-right:6px;" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                        <input id="golovi" class="form-control" asp-for="golovi" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend" style="width:25px;">
                                <span class="input-group-text" style="padding-left:4px;padding-right:6px;" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                        <input id="asistencije" class="form-control" asp-for="asistencije" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend" style="width:25px;">
                                <span class="input-group-text" style="padding-left:4px;padding-right:6px;" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                        <input id="zutiKartoni" class="form-control" asp-for="zutiKartoni" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend" style="width:25px;">
                                <span class="input-group-text" style="padding-left:4px;padding-right:6px;" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                        <input id="crveniKartoni" class="form-control" asp-for="crveniKartoni" type="number" />
                        </div>
                    </div>
                    <div class="col" style="padding-left:5px;">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend" style="width:25px;">
                                <span class="input-group-text" style="padding-left:4px;padding-right:6px;" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                        <input id="ocjena" class="form-control" asp-for="ocjena" type="number" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label for="exampleFormControlTextarea4">Komentar</label>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-sticky-note" aria-hidden="true"></i></span>
                            </div>
                            <textarea placeholder="Komentar na nastup..." asp-for="komentar" class="form-control" id="exampleFormControlTextarea4" rows="4"></textarea>
                        </div>
                    </div>
                </div>
                <hr />
                <div class="row" id="statistika">
                    <div class="col" id="colPadding" style="padding-right:5px;">
                        <span>Kontrola lopte</span>
                    </div>
                    <div class="col" id="colPadding">
                        <span>Driblanje</span>
                    </div>
                    <div class="col" id="colPadding">
                        <span>Dodavanje</span>
                    </div>
                    <div class="col" id="colPadding">
                        <span>Kretanje</span>
                    </div>
                    <div class="col" id="colPadding">
                        <span>Brzina</span>
                    </div>
                    <div class="col" id="colPadding" style="margin-right:10px;">
                        <span>Šut</span>
                    </div>
                </div>
                <div class="row" id="statistika">
                    <div class="col" style="padding-right:5px;">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input id="kontrolaLopte" class="form-control statistika" asp-for="kontrolaLopte" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input id="dribljanje" class="form-control statistika" asp-for="dribljanje" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input id="dodavanje" class="form-control statistika" asp-for="dodavanje" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input id="kretanje" class="form-control statistika" asp-for="kretanje" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input id="brzina" class="form-control statistika" asp-for="brzina" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding" style="margin-right:10px;">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input id="sut" class="form-control statistika" asp-for="sut" type="number" />
                        </div>
                    </div>
                </div>
                <div class="row" id="statistika">
                    <div class="col" id="colPadding" style="padding-right:5px;">
                        <span>Snaga</span>
                    </div>
                    <div class="col" id="colPadding">
                        <span>Markiranje</span>
                    </div>
                    <div class="col" id="colPadding">
                        <span>Klizeći start</span>
                    </div>
                    <div class="col" id="colPadding">
                        <span>Skok</span>
                    </div>
                    <div class="col" id="colPadding">
                        <span>Odbrana</span>
                    </div>
                    <div class="col" id="colPadding" style="margin-right:10px;">
                        <span>Prosječna ocjena</span>
                    </div>
                </div>
                <div class="row" id="statistika">
                    <div class="col" style="padding-right:5px;">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input id="snaga" class="form-control statistika" asp-for="snaga" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input id="markiranje" class="form-control statistika" asp-for="markiranje" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input id="klizeciStart" class="form-control statistika" asp-for="klizeciStart" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input id="skok" class="form-control statistika" asp-for="skok" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input id="odbrana" class="form-control statistika" asp-for="odbrana" type="number" />
                        </div>
                    </div>
                    <div class="col" id="colPadding" style="margin-right:10px;">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1"><i class="fa fa-hashtag" aria-hidden="true"></i></span>
                            </div>
                            <input readonly id="prosjecnaOcjena" class="form-control" asp-for="prosjecnaOcjena" type="text" />
                        </div>
                    </div>
                </div>  
                <div class="row" style="margin-top:10px;margin-bottom:15px;">
                    <div class="col">
                        @if (izmjena)
                        {
                            <button class="btn btn-warning" onclick="SpasiIzmjene()" type="button" style="float:right;">
                                <span style="margin-right:4px;"><i class="fa fa-check"></i></span> Spasi izmjene
                            </button>
                        }
                        else
                        {
                            <button class="btn btn-success" onclick="SpasiStatistiku()" type="button" style="float:right;">
                                <span style="margin-right:4px;"><i class="fa fa-check"></i></span> Spasi statistiku
                            </button>
                        }
                        <button id="odustaniBtn" class="btn btn-danger" onclick="odustani()" type="button" style="float:right;margin-right:7px;display:none;">
                            <span style="margin-right:4px;"><i class="fa fa-times"></i></span> Odustani
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="row">
    <div class="col">
        <div id="getNastupi"></div>
    </div>
</div>

<script>
    $(".form-control").change(function () {
        document.getElementById("odustaniBtn").style.display = "block";
    });
    function odustani() {
        var utakmicaID = document.getElementById("utakmicaID").value;
        var url = "/Izvještaj/DodajNastup?utakmicaID=" + utakmicaID;;
        $.get(url, function (d) {
            $("#dodajNastup").html(d);
        });
    }
    $("#zutiKartoni").change(function () {
        var brojKartona = document.getElementById("zutiKartoni").value;
        if (brojKartona == 2) {
            document.getElementById("crveniKartoni").value = 1;
            document.getElementById("crveniKartoni").readOnly = true;
        }
        if (brojKartona > 2) {
            document.getElementById("crveniKartoni").value = 1;
            document.getElementById("zutiKartoni").value = 2;
            document.getElementById("crveniKartoni").readOnly = true;
        }
        else {
            document.getElementById("crveniKartoni").readOnly = false;
        }
    });
    $(".statistika").change(function () {
        var rezultat = 0;
        var uneseniE = 0;
        var elementi = document.getElementsByClassName("statistika");
        for (i = 0; i < elementi.length; i++) {
            if (elementi[i].value != 0) {
                uneseniE = parseInt(uneseniE) + 1;
            }
            rezultat = parseInt(rezultat) + parseInt(elementi[i].value);
        }
        document.getElementById("prosjecnaOcjena").value = (rezultat / uneseniE).toFixed(2);
    });
    $("#btnCollapseDown").click(function () {
        $("#clps1").collapse('show');
    });
    $("#btnCollapseUp").click(function () {
        $("#clps1").collapse('hide');
    });
    function SpasiIzmjene() {
        var minute = document.getElementById("minute").value;
        if (minute == 0) {
            notifikacija("Statistika nije spašena, igrač nije nastupio!");
            return;
        }
        else {
            var ocjena = document.getElementById("ocjena").value;
            if (ocjena == 0) {
                notifikacija("Ocjena nije evidentirana!");
                return;
            }
            if (ocjena > 10) {
                notifikacija("Ocjena ne smije biti veća od 10!");
                return;
            }
        }
        var form = $("#snimiStatistiku");
        var url = "/Izvještaj/spasiIzmjene";
        $.ajax({
            type: "POST",
            url: url,
            data: form.serialize(),
            success: function (msg) {
                $(document).ready(function () {
                    if (msg == "OK") {
                        var utakmicaID = document.getElementById("utakmicaID").value;
                        getNastupi(utakmicaID);
                        notifikacija("Statistika uspješno uređena!")
                        url = "/Izvještaj/DodajNastup?utakmicaID=" + utakmicaID;;
                        $.get(url, function (d) {
                            $("#dodajNastup").html(d);
                        });
                    }
                });
            },
            error: function (msg) {
                notifikacija("Greška u komunikaciji sa serverom!");
            }
        });
    }
    $(document).ready(function () {
        $("#clps1").collapse('show');
        var utakmicaID = document.getElementById("utakmicaID").value;
        var url = "/Izvještaj/getNastupi?utakmicaID=" + utakmicaID;
        $.get(url, function (d) {
            $("#getNastupi").html(d);
        });
    });
    function getNastupi(utakmicaID) {
        $(document).ready(function () {
            var url = "/Izvještaj/getNastupi?utakmicaID=" + utakmicaID;
            $.get(url, function (d) {
                $("#getNastupi").html(d);
            });
        });
    }
    function SpasiStatistiku() {
        var minute = document.getElementById("minute").value;
        if (minute == 0) {
            notifikacija("Statistika nije spašena, igrač nije nastupio!");
            return;
        }
        else {
            var ocjena = document.getElementById("ocjena").value;
            var elementi = document.getElementsByClassName("statistika");
            if (ocjena == 0) {
                notifikacija("Ocjena nije evidentirana!");
                return;
            }
            else if (ocjena > 10) {
                notifikacija("Ocjena ne smije biti veća od 10!");
                return;
            }
            for (i = 0; i < elementi.length; i++) {
                if (elementi[i].value == 0) {
                    notifikacija("Ocjena nije evidentirana!");
                    return;
                }
                if (elementi[i].value > 10) {
                    notifikacija("Ocjena ne smije biti veća od 10!");
                    return;
                }
            }
        }
        var form = $("#snimiStatistiku");
        var url = "/Izvještaj/spasiStatistiku";
        $.ajax({
            type: "POST",
            url: url,
            data: form.serialize(),
            success: function (msg) {
                $(document).ready(function () {
                    if (msg == "Statistika je već evidentirana!") {
                        notifikacija("Statistika je već evidentirana!")
                    }
                    if (msg == "OK") {
                        var utakmicaID = document.getElementById("utakmicaID").value;
                        getNastupi(utakmicaID);
                        notifikacija("Statistika uspješno evidentirana!")
                    }
                    if (msg == "Izvještaj nije kreiran!") {
                        notifikacija("Izvještaj nije kreiran!");
                    }
                    document.getElementById("minute").value = 0;
                    document.getElementById("golovi").value = 0;
                    document.getElementById("asistencije").value = 0;
                    document.getElementById("zutiKartoni").value = 0;
                    document.getElementById("crveniKartoni").value = 0;
                    document.getElementById("ocjena").value = 0;
                    document.getElementById("kontrolaLopte").value = 0;
                    document.getElementById("dribljanje").value = 0;
                    document.getElementById("dodavanje").value = 0;
                    document.getElementById("kretanje").value = 0;
                    document.getElementById("brzina").value = 0;
                    document.getElementById("sut").value = 0;
                    document.getElementById("snaga").value = 0;
                    document.getElementById("markiranje").value = 0;
                    document.getElementById("klizeciStart").value = 0;
                    document.getElementById("skok").value = 0;
                    document.getElementById("odbrana").value = 0;
                    document.getElementById("prosjecnaOcjena").value = 0;
                    url = "/Izvještaj/DodajNastup?utakmicaID=" + utakmicaID;;
                    $.get(url, function (d) {
                        $("#dodajNastup").html(d);
                    });
                });
            },
            error: function (msg) {
                notifikacija("Greška u komunikaciji sa serverom!");
            }
        });
    }
</script>
